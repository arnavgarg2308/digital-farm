<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <!-- Replace or add to Admin page where Farmer Overview should be -->
<div id="adminFarmersWrap" style="margin:18px 0;">
  <h3>Farmer Overview</h3>
<table id="farmerTable" border="1" style="width:100%; text-align:center; border-collapse:collapse; color:white; background:#111;">
  <thead style="background:#00ff99; color:black;">
    <tr>
      <th>Farmer Name</th>
      <th>Phone</th>
      <th>Email</th>
      <th>Farm Name</th>
      <th>Area</th>
      <th>Last Risk Score</th>
      <th>Risk Level</th>
      <th>Assessment Date</th>
    </tr>
  </thead>
  <tbody id="farmerTableBody"></tbody>
</table>

  <div id="farmerList" style="display:flex;flex-direction:column;gap:8px;"></div>
</div>

<!-- Farmer details modal (simple) -->
<!--<div id="farmerModal" class="hidden" style="position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;">-->
  
    <div id="farmerModalBody"></div>
  </div>
</div>
<script>
// Load farmer data + assessments
function renderFarmersOverview() {
  const users = JSON.parse(localStorage.getItem('users') || '[]');
  const assessments = JSON.parse(localStorage.getItem('assessments') || '[]');
  const tbody = document.getElementById('farmerTableBody');
  tbody.innerHTML = '';

  users.filter(u => u.role === 'farmer').forEach(u => {
    const userId = u.id || u.phone || u.email; // ensure consistency
   const userAssessments = assessments.filter(a => 
  (a.userId && (a.userId + '') === (userId + '')) ||
  (a.user && (a.user + '') === (userId + '')) ||
  (a.user && (a.user + '') === (u.phone + '')) ||
  (a.user && (a.user + '') === (u.email + ''))
);
   const last = userAssessments.length ? userAssessments[userAssessments.length - 1] : null;

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${u.fullName || u.name || '-'}</td>
      <td>${u.phone || '-'}</td>
      <td>${u.email || '-'}</td>
      <td>${u.farmName || '-'}</td>
      <td>${u.farmArea || '-'}</td>
      <td>${last ? last.score + '%' : 'N/A'}</td>
      <td style="color:${last ? (last.level === 'High' ? 'red' : last.level === 'Medium' ? 'orange' : 'lightgreen') : 'gray'};">
        ${last ? last.level : 'No Data'}
      </td>
      <td>${last ? new Date(last.createdAt).toLocaleString() : '-'}</td>
    `;
    tbody.appendChild(tr);
  });

  if (!tbody.innerHTML.trim()) {
    tbody.innerHTML = `<tr><td colspan="8">No farmer data found</td></tr>`;
  }
}

document.addEventListener('DOMContentLoaded', renderFarmersOverview);

</script>

</body>
</html>