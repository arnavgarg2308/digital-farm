// ================= TRANSLATIONS =================
const translations = {
  en: {
    title: "Welcome to Smart Farm Solution",
    subtitle: "Choose your role to continue",
    farmer: "Farmer",
    admin: "Admin",
    buyer: "Buyer/Wholesaler",
    hintLaunch: "Tip: Click role â†’ Signup (one time) â†’ Login â†’ Dashboard",
    loginTitle: "Login to Smart Farm Solution",
    signupTitle: "Create your Account",
    username: "Username",
    password: "Password",
    loginBtn: "Login",
    signupBtn: "Create Account",
    support: "Ai Chat+Support",
    dashboard: "Dashboard",
    Profile:"Profile",
    sup:"Support",
    log:"Logout",
    farmerDash:"ðŸ‘¨â€ðŸŒ¾ Farmer Dashboard",
    risk:"Risk Assessment",
    history:"Assessment History",
    take:"Take assessment",
    training:"Training & Guides",
    trainingHint:"Short videos & tips",
    schemes:"Government Schemes",
    loan:"Apply Loan",
    session:"Book Session",
    vaccine:"Vaccination Schedule",
    feed:"Breeding & Feeding",
    sales:"Sales / Products",
    alerts:"Alerts",
    schemesList:"No schemes yet (demo)",
    loanHint:"Apply for small farm loan",
    sessionHint:"Book paid learning sessions",
    vaccineChart:"25 Sept â€” Bird Flu",
    feedHint:"Feeding schedule and charts",
    salesHint:"Update product listings",
    ask:"Ask questions & get voice replies",
    open1:"Open Chat",
    adminDash:"ðŸ›  Admin Dashboard",
    overview:"Farm Overview",
    heat:"Heatmap",
    compliance:"Compliance Tracker",
    reports:"Reports",
    open:"Open Heatmap",
    send:"Send demo alert",
    add:"Admin can add Training videos and guide",
    not:"[Shows who hasn't done assessment]",
    csv:"Generate CSV",
    adsc:"Admin can add schemes (demo)",
    total:"Total: 0",
    low:"Low: 0 | Medium: 0 | High: 0",
    buyerDash:"ðŸ›’ Buyer Dashboard",
    purchase:"Purchasing",
    farmDetails:"Farm Details",
    booking:"Booking",
    payment:"Payment",
    browse:"Browse Listings",
    ram:"Ramesh Poultry â€” Moderate Risk (demo)",
    book:"Book Order",
    pendind:"Pending: â‚¹0",
    pay:"Pay Now",
    feedpig:"View Chart",
    vetBookings:"Vet Bookings",
    medicineOrders:"Medicine Orders"
  },
  hi: {
    title: "à¤¸à¥à¤®à¤¾à¤°à¥à¤Ÿ à¤«à¤¾à¤°à¥à¤® à¤¸à¥‰à¤²à¥à¤¯à¥‚à¤¶à¤¨ à¤®à¥‡à¤‚ à¤†à¤ªà¤•à¤¾ à¤¸à¥à¤µà¤¾à¤—à¤¤ à¤¹à¥ˆ",
    subtitle: "à¤œà¤¾à¤°à¥€ à¤°à¤–à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤…à¤ªà¤¨à¥€ à¤­à¥‚à¤®à¤¿à¤•à¤¾ à¤šà¥à¤¨à¥‡à¤‚",
    farmer: "à¤•à¤¿à¤¸à¤¾à¤¨",
    admin: "à¤ªà¥à¤°à¤¶à¤¾à¤¸à¤•",
    buyer: "à¤–à¤°à¥€à¤¦à¤¾à¤°/à¤¥à¥‹à¤• à¤µà¥à¤¯à¤¾à¤ªà¤¾à¤°à¥€",
    hintLaunch: "à¤Ÿà¤¿à¤ª: à¤­à¥‚à¤®à¤¿à¤•à¤¾ à¤šà¥à¤¨à¥‡à¤‚ â†’ à¤¸à¤¾à¤‡à¤¨à¤…à¤ª (à¤à¤• à¤¬à¤¾à¤°) â†’ à¤²à¥‰à¤—à¤¿à¤¨ â†’ à¤¡à¥ˆà¤¶à¤¬à¥‹à¤°à¥à¤¡",
    loginTitle: "à¤¸à¥à¤®à¤¾à¤°à¥à¤Ÿ à¤«à¤¾à¤°à¥à¤® à¤¸à¥‰à¤²à¥à¤¯à¥‚à¤¶à¤¨ à¤®à¥‡à¤‚ à¤²à¥‰à¤—à¤¿à¤¨ à¤•à¤°à¥‡à¤‚",
    signupTitle: "à¤…à¤ªà¤¨à¤¾ à¤–à¤¾à¤¤à¤¾ à¤¬à¤¨à¤¾à¤à¤‚",
    username: "à¤‰à¤ªà¤¯à¥‹à¤—à¤•à¤°à¥à¤¤à¤¾ à¤¨à¤¾à¤®",
    password: "à¤ªà¤¾à¤¸à¤µà¤°à¥à¤¡",
    loginBtn: "à¤²à¥‰à¤—à¤¿à¤¨",
    signupBtn: "à¤–à¤¾à¤¤à¤¾ à¤¬à¤¨à¤¾à¤à¤‚",
    support: "à¤ à¤šà¥ˆà¤Ÿ+à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾",
    dashboard: "à¤¡à¥ˆà¤¶à¤¬à¥‹à¤°à¥à¤¡",
    Profile:"à¤ªà¥à¤°à¥‹à¤«à¤¼à¤¾à¤‡à¤²",
    sup:"à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾",
    log:"à¤²à¥‰à¤—à¤†à¤‰à¤Ÿ",
    farmerDash:"ðŸ‘¨â€ðŸŒ¾ à¤•à¤¿à¤¸à¤¾à¤¨ à¤¡à¥ˆà¤¶à¤¬à¥‹à¤°à¥à¤¡",
    risk:"à¤œà¥‹à¤–à¤¿à¤® à¤®à¥‚à¤²à¥à¤¯à¤¾à¤‚à¤•à¤¨",
    history:"à¤®à¥‚à¤²à¥à¤¯à¤¾à¤‚à¤•à¤¨ à¤‡à¤¤à¤¿à¤¹à¤¾à¤¸",
    take:"à¤®à¥‚à¤²à¥à¤¯à¤¾à¤‚à¤•à¤¨ à¤•à¤°à¥‡à¤‚",
    training:"à¤ªà¥à¤°à¤¶à¤¿à¤•à¥à¤·à¤£ à¤”à¤° à¤®à¤¾à¤°à¥à¤—à¤¦à¤°à¥à¤¶à¤¿à¤•à¤¾à¤à¤",
    trainingHint:"à¤›à¥‹à¤Ÿà¥€ à¤µà¥€à¤¡à¤¿à¤¯à¥‹ à¤”à¤° à¤¸à¥à¤à¤¾à¤µ",
    schemes:"à¤¸à¤°à¤•à¤¾à¤°à¥€ à¤¯à¥‹à¤œà¤¨à¤¾à¤à¤",
    loan:"à¤‹à¤£ à¤•à¥‡ à¤²à¤¿à¤ à¤†à¤µà¥‡à¤¦à¤¨ à¤•à¤°à¥‡à¤‚",
    session:"à¤¸à¤¤à¥à¤° à¤¬à¥à¤• à¤•à¤°à¥‡à¤‚",
    vaccine:"à¤µà¥ˆà¤•à¥à¤¸à¥€à¤¨à¥‡à¤¶à¤¨ à¤•à¤¾à¤°à¥à¤¯à¤•à¥à¤°à¤®",
    feed:"à¤ªà¥à¤°à¤œà¤¨à¤¨ à¤”à¤° à¤­à¥‹à¤œà¤¨",
    sales:"à¤¬à¤¿à¤•à¥à¤°à¥€/à¤‰à¤¤à¥à¤ªà¤¾à¤¦",
    alerts:"à¤…à¤²à¤°à¥à¤Ÿà¥à¤¸",
    schemesList:"à¤…à¤­à¥€ à¤¤à¤• à¤•à¥‹à¤ˆ à¤¯à¥‹à¤œà¤¨à¤¾à¤à¤‚ à¤¨à¤¹à¥€à¤‚ (à¤¡à¥‡à¤®à¥‹)",
    loanHint:"à¤›à¥‹à¤Ÿà¥€ à¤•à¥ƒà¤·à¤¿ à¤‹à¤£ à¤•à¥‡ à¤²à¤¿à¤ à¤†à¤µà¥‡à¤¦à¤¨ à¤•à¤°à¥‡à¤‚",
    sessionHint:"à¤ªà¥‡à¤¡ à¤²à¤°à¥à¤¨à¤¿à¤‚à¤— à¤¸à¤¤à¥à¤°à¥‹à¤‚ à¤•à¥‹ à¤¬à¥à¤• à¤•à¤°à¥‡à¤‚",
    vaccineChart:"25 à¤¸à¤¿à¤¤à¤‚à¤¬à¤° - à¤¬à¤°à¥à¤¡ à¤«à¥à¤²à¥‚",
    feedHint:"à¤–à¤¿à¤²à¤¾à¤¨à¥‡ à¤•à¥‡ à¤•à¤¾à¤°à¥à¤¯à¤•à¥à¤°à¤® à¤”à¤° à¤šà¤¾à¤°à¥à¤Ÿ",
    salesHint:"à¤‰à¤¤à¥à¤ªà¤¾à¤¦ à¤¸à¥‚à¤šà¥€ à¤…à¤ªà¤¡à¥‡à¤Ÿ à¤•à¤°à¥‡à¤‚",
    ask:"à¤ªà¥à¤°à¤¶à¥à¤¨ à¤ªà¥‚à¤›à¥‡à¤‚ à¤”à¤° à¤†à¤µà¤¾à¤œà¤¼ à¤®à¥‡à¤‚ à¤‰à¤¤à¥à¤¤à¤° à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤ à¤•à¤°à¥‡à¤‚",
    open1:"à¤šà¥ˆà¤Ÿ à¤–à¥‹à¤²à¥‡à¤‚",
    adminDash:"ðŸ›  à¤ªà¥à¤°à¤¬à¤‚à¤§à¤• à¤¡à¥ˆà¤¶à¤¬à¥‹à¤°à¥à¤¡",
    overview:"à¤«à¤¾à¤°à¥à¤® à¤•à¤¾ à¤…à¤µà¤²à¥‹à¤•à¤¨",
    heat:"à¤¹à¥€à¤Ÿ à¤…à¤ª à¤®à¥ˆà¤ª",
    compliance:"à¤…à¤¨à¥à¤ªà¤¾à¤²à¤¨ à¤Ÿà¥à¤°à¥ˆà¤•à¤°",
    reports:"à¤°à¤¿à¤ªà¥‹à¤°à¥à¤Ÿ",
    open:"à¤“à¤ªà¤¨ à¤¹à¥€à¤Ÿà¤®à¥ˆà¤ª",
    send:"à¤¡à¥‡à¤®à¥‹ à¤…à¤²à¤°à¥à¤Ÿ à¤­à¥‡à¤œà¥‡à¤‚",
    add:"à¤à¤¡à¤®à¤¿à¤¨ à¤ªà¥à¤°à¤¶à¤¿à¤•à¥à¤·à¤£ à¤µà¥€à¤¡à¤¿à¤¯à¥‹ à¤”à¤° à¤®à¤¾à¤°à¥à¤—à¤¦à¤°à¥à¤¶à¤¿à¤•à¤¾ à¤œà¥‹à¤¡à¤¼ à¤¸à¤•à¤¤à¤¾ à¤¹à¥ˆ",
    not:"[à¤ªà¥à¤°à¤¦à¤°à¥à¤¶à¤¿à¤¤ à¤•à¤°à¥‡à¤‚ à¤•à¤¿ à¤•à¤¿à¤¸à¤¨à¥‡ à¤†à¤•à¤²à¤¨ à¤¨à¤¹à¥€à¤‚ à¤•à¤¿à¤¯à¤¾ à¤¹à¥ˆ]",
    csv:"à¤¸à¥€à¤à¤¸à¤µà¥€ à¤‰à¤¤à¥à¤ªà¤¨à¥à¤¨ à¤•à¤°à¥‡à¤‚",
    adsc:"à¤µà¥à¤¯à¤µà¤¸à¥à¤¥à¤¾à¤ªà¤• à¤¯à¥‹à¤œà¤¨à¤¾à¤à¤ à¤œà¥‹à¤¡à¤¼ à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚ (à¤¡à¥‡à¤®à¥‹)",
    total:"à¤•à¥à¤²: 0",
    low:"à¤•à¤®: 0 | à¤®à¤§à¥à¤¯à¤®: 0 | à¤‰à¤šà¥à¤š: 0",
    buyerDash:"ðŸ›’ à¤–à¤°à¥€à¤¦à¤¦à¤¾à¤° à¤¡à¥ˆà¤¶à¤¬à¥‹à¤°à¥à¤¡",
    purchase:"à¤–à¤°à¥€à¤¦à¤¾à¤°à¥€",
    farmDetails:"à¤«à¤¾à¤°à¥à¤® à¤•à¤¾ à¤µà¤¿à¤µà¤°à¤£",
    booking:"à¤¬à¥à¤•à¤¿à¤‚à¤—",
    payment:"à¤­à¥à¤—à¤¤à¤¾à¤¨",
    browse:"à¤¸à¥‚à¤šà¥€ à¤¬à¥à¤°à¤¾à¤‰à¤œà¤¼ à¤•à¤°à¥‡à¤‚",
    ram:"à¤°à¤¾à¤®à¥‡à¤¶ à¤ªà¥‹à¤²à¥à¤Ÿà¥à¤°à¥€ â€” à¤®à¤§à¥à¤¯ à¤œà¥‹à¤–à¤¿à¤® (à¤¡à¥‡à¤®à¥‹)",
    book:"à¤ªà¥à¤¸à¥à¤¤à¤• à¤†à¤¦à¥‡à¤¶",
    pendind:"à¤²à¤‚à¤¬à¤¿à¤¤:â‚¹0",
    pay:"à¤…à¤¬ à¤­à¥à¤—à¤¤à¤¾à¤¨ à¤•à¤°à¥‡à¤‚",
    feedpig:"à¤šà¤¾à¤°à¥à¤Ÿ à¤¦à¥‡à¤–à¥‡à¤‚",
    vetBookings:"à¤ªà¤¶à¥ à¤šà¤¿à¤•à¤¿à¤¤à¥à¤¸à¤• à¤¬à¥à¤•à¤¿à¤‚à¤—",
    medicineOrders:"à¤¦à¤µà¤¾ à¤‘à¤°à¥à¤¡à¤°"
  }
};

// =================== LANGUAGE SWITCH ===================
function changeLanguage(lang) {
  document.querySelectorAll("[data-lang]").forEach(el => {
    const key = el.getAttribute("data-lang");
    if (translations[lang] && translations[lang][key]) {
      el.textContent = translations[lang][key];
    }
  });
  localStorage.setItem("lang", lang);
}

// ================== SCHEMES MANAGEMENT ==================
function showAddSchemeForm() {
  document.getElementById('addSchemeForm').style.display = 'block';
}

function saveScheme() {
  const title = document.getElementById('schemeTitle').value.trim();
  const description = document.getElementById('schemeDescription').value.trim();
  const eligibility = document.getElementById('schemeEligibility').value.trim();
  const farmType = document.getElementById('schemeFarmType').value.trim();
  const expiry = document.getElementById('schemeExpiry').value;

  if (!title || !description) {
    alert('Title and Description are required!');
    return;
  }

  const schemes = JSON.parse(localStorage.getItem('schemes') || '[]');
  schemes.push({ id: Date.now(), title, description, eligibility, farmType, expiry, createdAt: new Date().toISOString() });
  localStorage.setItem('schemes', JSON.stringify(schemes));
  alert('Scheme added successfully âœ…');

  // reset form
  ['schemeTitle','schemeDescription','schemeEligibility','schemeFarmType','schemeExpiry'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('addSchemeForm').style.display = 'none';
}

function displaySchemesForUser() {
  const container = document.getElementById('schemesContainer');
  if (!container) return;

  const schemes = JSON.parse(localStorage.getItem('schemes') || '[]');
  container.innerHTML = '';
  const today = new Date().toISOString().split('T')[0];
  const currentUser = JSON.parse(localStorage.getItem('currentUser_farmer') || '{}');

  if (schemes.length === 0) { container.innerHTML = '<p>No schemes available.</p>'; return; }

  schemes.forEach((s,index)=>{
    const farmMatch = !s.farmType || (currentUser.farmType && s.farmType.toLowerCase()===currentUser.farmType.toLowerCase());
    const notExpired = !s.expiry || s.expiry>=today;
    if (currentUser.role==='farmer' && !(farmMatch && notExpired)) return;

    const div = document.createElement('div');
    div.className='scheme-card';
    div.innerHTML=`<h4>${s.title}</h4><p>${s.description}</p>
      <small>Eligibility: ${s.eligibility||'N/A'}</small><br>
      <small>Farm Type: ${s.farmType||'All'}</small><br>
      <small>Expires: ${s.expiry||'N/A'}</small><br>`;
    if(currentUser.role==='admin'){
      const btn=document.createElement('button');
      btn.textContent='Delete';
      btn.className='delete-btn';
      btn.onclick=()=>deleteScheme(index);
      div.appendChild(btn);
    }
    container.appendChild(div);
  });
}

function deleteScheme(index){
  if(!confirm("Are you sure you want to delete this scheme?")) return;
  const schemes=JSON.parse(localStorage.getItem('schemes')||'[]');
  schemes.splice(index,1);
  localStorage.setItem('schemes',JSON.stringify(schemes));
  displaySchemesForUser();
  alert("Scheme deleted successfully!");
}

// ================== SIGNUP / LOGIN ==================
function signupUser(e, role){
  e.preventDefault();
  const users = JSON.parse(localStorage.getItem('users')||'[]');
  const email = document.getElementById('email').value.trim().toLowerCase();
  const phone = document.getElementById('phone').value.trim();
  if(users.some(u=>u.email===email)){ alert('Email already registered.'); return; }
  if(users.some(u=>u.phone===phone)){ alert('Phone number already registered.'); return; }

  const user = {id:Date.now(), name:document.getElementById('name').value.trim(), email, password:document.getElementById('password').value.trim(), phone, role, avatar:"", createdAt:new Date().toISOString()};
  if(role==='farmer'){ user.farmName=document.getElementById('farmName')?.value||''; user.farmArea=document.getElementById('farmArea')?.value||''; user.district=document.getElementById('district')?.value||''; user.state=document.getElementById('state')?.value||''; user.village=document.getElementById('village')?.value||''; user.productionType=document.getElementById('productionType')?.value||''; }
  if(role==='admin'){ user.designation=document.getElementById('designation')?.value||''; user.organization=document.getElementById('organization')?.value||''; user.officeAddress=document.getElementById('officeAddress')?.value||''; user.adminCode=document.getElementById('adminCode')?.value||''; if(user.adminCode!=='ADMIN2024'){alert('Invalid Admin Access Code!');return;} }
  if(role==='buyer'){ user.company=document.getElementById('company')?.value||''; user.companyAddress=document.getElementById('companyAddress')?.value||''; user.gst=document.getElementById('gst')?.value||''; user.businessType=document.getElementById('businessType')?.value||''; }

  users.push(user);
  localStorage.setItem('users',JSON.stringify(users));
  alert('Account created successfully! Redirecting to login...');
  setTimeout(()=>window.location.href=`${role}-login.html`,1500);
}

function loginUser(e,role){
  e.preventDefault();
  const email=document.getElementById('loginEmail').value.trim().toLowerCase();
  const pass=document.getElementById('loginPassword').value;
  const users=JSON.parse(localStorage.getItem('users')||'[]');
  const u=users.find(x=>x.email===email && x.password===pass && x.role===role);
  if(!u) return alert('Invalid credentials or wrong role.');
  localStorage.setItem(`currentUser_${role}`,JSON.stringify(u));
  alert('Login successful âœ… Redirecting to dashboard...');
  setTimeout(()=>window.location.href=`${role}-dashboard.html`,500);
}

// =================== PROFILE ===================
function openProfile(){
  const user=JSON.parse(localStorage.getItem('currentUser_farmer')||'{}');
  if(!user) return;
  document.getElementById('profileName').value=user.name||'';
  document.getElementById('profileEmail').value=user.email||'';
  document.getElementById('profilePhone').value=user.phone||'';
  document.getElementById('profileFarmName').value=user.farmName||'';
  document.getElementById('profileFarmArea').value=user.farmArea||'';
  document.getElementById('profileDistrict').value=user.district||'';
  document.getElementById('profileState').value=user.state||'';
  document.getElementById('profileVillage').value=user.village||'';
  document.getElementById('profileProductionType').value=user.productionType||'';
}

function saveProfileChanges(){
  const user=JSON.parse(localStorage.getItem('currentUser_farmer')||'{}');
  if(!user) return;
  ['profileName','profileEmail','profilePhone','profileFarmName','profileFarmArea','profileDistrict','profileState','profileVillage','profileProductionType'].forEach(id=>{
    const val=document.getElementById(id)?.value; if(val) user[id.replace('profile','').toLowerCase()]=val;
  });
  let users=JSON.parse(localStorage.getItem('users')||'[]');
  const idx=users.findIndex(u=>u.id===user.id);
  if(idx!==-1){ users[idx]=user; localStorage.setItem('users',JSON.stringify(users)); localStorage.setItem('currentUser_farmer',JSON.stringify(user)); alert('Profile updated!'); }
}

// ================== VET BOOKINGS & MEDICINES ==================
function bookVetAppointment(e){
  e.preventDefault();
  const currentUser=JSON.parse(localStorage.getItem('currentUser_farmer')||'{}');
  if(!currentUser){ alert('Please login as farmer'); return; }
  const name=document.getElementById('vetPetName').value.trim();
  const date=document.getElementById('vetDate').value;
  if(!name||!date){ alert('Pet Name & Date required'); return; }
  const bookings=JSON.parse(localStorage.getItem('vetBookings')||'[]');
  bookings.push({id:Date.now(), farmerId:currentUser.id, farmerName:currentUser.name, petName:name, date, status:'Pending', createdAt:new Date().toISOString()});
  localStorage.setItem('vetBookings',JSON.stringify(bookings));
  alert('Appointment booked âœ…');
  document.getElementById('vetPetName').value=''; document.getElementById('vetDate').value='';
  fetchMedicalData();
}

function placeMedicineOrder(e){
  e.preventDefault();
  const currentUser=JSON.parse(localStorage.getItem('currentUser_farmer')||'{}');
  if(!currentUser){ alert('Please login as farmer'); return; }
  const med=document.getElementById('medicineName').value.trim();
  const qty=document.getElementById('medicineQty').value.trim();
  if(!med||!qty){ alert('Medicine Name & Quantity required'); return; }
  const orders=JSON.parse(localStorage.getItem('medicineOrders')||'[]');
  orders.push({id:Date.now(), farmerId:currentUser.id, farmerName:currentUser.name, medicineName:med, qty, status:'Pending', createdAt:new Date().toISOString()});
  localStorage.setItem('medicineOrders',JSON.stringify(orders));
  alert('Medicine order placed âœ…');
  document.getElementById('medicineName').value=''; document.getElementById('medicineQty').value='';
  fetchMedicalData();
}

function fetchMedicalData(){
  const bookings=JSON.parse(localStorage.getItem('vetBookings')||'[]');
  const orders=JSON.parse(localStorage.getItem('medicineOrders')||'[]');
  const bookingContainer=document.getElementById('vetBookingsContainer');
  const ordersContainer=document.getElementById('medicineOrdersContainer');
  if(bookingContainer){
    bookingContainer.innerHTML='';
    bookings.forEach(b=>{
      const div=document.createElement('div');
      div.className='vet-booking-card';
      div.innerHTML=`<b>${b.farmerName}</b> | Pet: ${b.petName} | Date: ${b.date} | Status: ${b.status}`;
      if(JSON.parse(localStorage.getItem('currentUser_admin')||'{}').role==='admin'){
        const btn=document.createElement('button'); btn.textContent='Approve'; btn.onclick=()=>updateBookingStatus(b.id,'Approved'); div.appendChild(btn);
        const btn2=document.createElement('button'); btn2.textContent='Reject'; btn2.onclick=()=>updateBookingStatus(b.id,'Rejected'); div.appendChild(btn2);
      }
      bookingContainer.appendChild(div);
    });
  }
  if(ordersContainer){
    ordersContainer.innerHTML='';
    orders.forEach(o=>{
      const div=document.createElement('div');
      div.className='medicine-order-card';
      div.innerHTML=`<b>${o.farmerName}</b> | Medicine: ${o.medicineName} | Qty: ${o.qty} | Status: ${o.status}`;
      if(JSON.parse(localStorage.getItem('currentUser_admin')||'{}').role==='admin'){
        const btn=document.createElement('button'); btn.textContent='Approve'; btn.onclick=()=>updateOrderStatus(o.id,'Approved'); div.appendChild(btn);
        const btn2=document.createElement('button'); btn2.textContent='Reject'; btn2.onclick=()=>updateOrderStatus(o.id,'Rejected'); div.appendChild(btn2);
      }
      ordersContainer.appendChild(div);
    });
  }
}

function updateBookingStatus(id,status){
  let bookings=JSON.parse(localStorage.getItem('vetBookings')||'[]');
  const idx=bookings.findIndex(b=>b.id===id); if(idx!==-1){ bookings[idx].status=status; localStorage.setItem('vetBookings',JSON.stringify(bookings)); fetchMedicalData(); }
}

function updateOrderStatus(id,status){
  let orders=JSON.parse(localStorage.getItem('medicineOrders')||'[]');
  const idx=orders.findIndex(o=>o.id===id); if(idx!==-1){ orders[idx].status=status; localStorage.setItem('medicineOrders',JSON.stringify(orders)); fetchMedicalData(); }
}

// =================== INITIAL LOAD ===================
document.addEventListener('DOMContentLoaded',()=>{
  const lang=localStorage.getItem('lang')||'en';
  changeLanguage(lang);
  displaySchemesForUser();
  fetchMedicalData();
});
