<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Your Cart</title>
<style>
body{background:#0c0c0c;color:#eee;font-family:Inter,system-ui;padding:20px;}
h1{color:#00c853;}
.cart-item{background:#161616;margin-bottom:10px;padding:10px;border-radius:8px;display:flex;gap:10px;align-items:center;}
.cart-item img{width:80px;height:80px;object-fit:cover;border-radius:8px;}
.btn{padding:6px 10px;border:none;border-radius:6px;cursor:pointer;}
.remove{background:#e53935;color:#fff;}
.place{background:#00c853;color:#031;padding:8px 14px;font-weight:700;}
</style>
</head>
<body>
<h1>Your Cart</h1>
<div id="cartList"></div>
<div id="emptyBox" style="color:#aaa;">No items yet.</div>
<div style="margin-top:20px;">
  <button class="place" onclick="placeOrder()">ðŸ“¦ Place Order</button>
</div>

<script>
function getCurrentUser() {
  return JSON.parse(localStorage.getItem('currentUser_buyer') || 'null');
}
function loadCart() {
  const u = getCurrentUser();
  if (!u) return [];
  return JSON.parse(localStorage.getItem('cart_' + u.id) || '[]');
}
function saveCart(arr) {
  const u = getCurrentUser();
  if (!u) return;
  localStorage.setItem('cart_' + u.id, JSON.stringify(arr));
}

function renderCart() {
  const box = document.getElementById('cartList');
  const empty = document.getElementById('emptyBox');
  const cart = loadCart();
  box.innerHTML = '';
  if (!cart.length) { empty.style.display = 'block'; return; }
  empty.style.display = 'none';

  cart.forEach((p,i)=>{
    const div = document.createElement('div');
    div.className = 'cart-item';
    div.innerHTML = `
      <img src="${p.images?.[0] || ''}">
      <div style="flex:1">
        <div style="font-weight:700">${p.title}</div>
        <div style="color:#aaa;font-size:0.9rem">â‚¹${p.price} â€¢ ${p.stock}kg</div>
        <small style="color:#777">By ${p.farmerName}</small>
      </div>
      <button class="btn remove" onclick="removeItem(${i})">Remove</button>
    `;
    box.appendChild(div);
  });
}

function removeItem(i){
  const cart = loadCart();
  cart.splice(i,1);
  saveCart(cart);
  renderCart();
}

function placeOrder(){
  const u = getCurrentUser();
  if (!u) return alert('Please login as Buyer.');
  const cart = loadCart();
  if (!cart.length) return alert('Your cart is empty.');

  // store under buyerOrders_<buyerId>
  const orders = JSON.parse(localStorage.getItem('buyerOrders_' + u.id) || '[]');
  const newOrders = cart.map(p=>({...p, status:'Pending', orderId: Date.now()+Math.random()}));
  orders.push(...newOrders);
  localStorage.setItem('buyerOrders_' + u.id, JSON.stringify(orders));

  saveCart([]); // clear cart
  renderCart();
  alert('âœ… Order placed successfully!');
}

document.addEventListener('DOMContentLoaded', renderCart);
</script>
</body>
</html>
